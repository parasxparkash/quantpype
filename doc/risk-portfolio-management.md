# AI Agent Risk & Portfolio Management

In algorithmic high-frequency trading, executing a trade idea (Alpha) is simple. Ensuring that trade idea doesn't over-leverage the fund or violate global risk parameters is the profound challenge. 

QuantPype solves this by structurally separating **Alpha Generation** from **Risk Management**. In the QuantPype ecosystem, Risk Management is not a piece of static code; it is a dedicated swarm of specialized AI agents built specifically to enforce portfolio balance.

---

## 1. The Separation of Powers
QuantPype enforces a strict "Separation of Concerns" between agents:
*   **Alpha Agents (The "Yes" Agents):** Models like `NeuralArb-Pro` are specifically trained to identify opportunities and aggressively seek return. They are constantly generating buy/sell signals. They do not know, nor do they care about, the fund's total available margin.
*   **Risk Agents (The "No" Agents):** Models like `RiskSentinel-V2` and `Guardian.ai` do not generate trade ideas. Their sole purpose within the swarm architecture is to constantly calculate exposure and ruthlessly veto any signal that throws the portfolio out of balance.

By forcing these specialized SLMs (Small Language Models) to argue with each other within a millisecond timeframe before execution, QuantPype achieves algorithmic checks and balances.

---

## 2. How the Risk Agents Work
When an Alpha Agent computes a signal, it passes an `<Execution Proposal>` to the Risk layer. This proposal includes the Asset, Direction, Quantity, and Confidence Score.

The Risk Swarm immediately processes this proposal against real-time telemetry:

### A. Sub-millisecond Pre-Trade Checks (`RiskSentinel-V2`)
Before a FIX order ever touches an exchange, `RiskSentinel` evaluates the proposal against hard parameters:
*   **Fat-Finger Checks:** Is the requested order size statistically anomalous compared to the last 10,000 trades generated by this specific Alpha pipeline? If NeuralArb usually requests lots of 100, and suddenly requests 10,000, `RiskSentinel` kills the trade instantly.
*   **Margin & Leverage:** Does executing this trade push the account beyond the hard-coded absolute margin limits (e.g., maximum 4x intraday leverage)?
*   **Wash Trade Prevention:** Is another agent currently holding the exact opposite position? (e.g., `AlphaScanner` is currently shorting TSLA, while `SentimentX` proposes buying TSLA).

### B. Dynamic Exposure & Sizing (`VolatilityNexus`)
If `RiskSentinel` confirms the trade won't blow up the account, the proposal is routed to sizing agents like `VolatilityNexus`.
*   **Volatility Targeting:** This agent adjusts the position size based on current market turbulence (VIX or realized asset variance). In a highly volatile market, the agent scales down the lot size for the incoming Alpha signal. In a low-volatility environment, it leverages up. This ensures the fund takes exactly a targeted amount of "risk units" per trade, balancing risk and theoretical return.

---

## 3. Global Portfolio Balancing (`Guardian.ai`)
While individual trades are instantly checked by `RiskSentinel`, the overarching fund is managed by **`Guardian.ai`**.

### The Multi-Strategy Problem
QuantPype funds run various strategies simultaneously (e.g., Equities, Macro Fixed Income, Alternative Data sentiment). If Equities crash, but Macro Fixed Income correlates positively with the crash, the fund inherits massive, unintended systemic risk.

### Agentic Risk Parity
`Guardian.ai` is a specialized optimization model that constantly oversees the *correlation matrix* of all active strategies across the entire fund.
1.  **Continuous Telemetry:** It ingests the live PnL, drawdowns, and real-time correlations between the active `Pipelines` (e.g., checking if `NeuralArb` trades are suddenly correlating highly with `LiquidityFlow` trades).
2.  **Capital Reallocation:** If `Guardian.ai` detects a high theoretical correlation forming across strategies (meaning too many agents are betting on the same underlying macroeconomic factor), it automatically reduces capital allocation to the underperforming/redundant pipelines and reallocates margin to un-correlated agents.
3.  **Drawdown Enforcer:** `Guardian.ai` monitors the Max Drawdown curves of specific deployed Alpha Agents. If a specific pipeline (e.g., `MacroDrift`) breaches its historical drawdown threshold, `Guardian.ai` completely severs its API execution rights and stops the pipeline autonomously.

---

## 4. Summary of the Millisecond Flow
The complete Risk/Return lifecycle of a QuantPype trade:
1.  **Alpha Generation:** AI agent identifies a micro-structure opportunity. Return: Expected high. Risk: Unknown.
2.  **Volatility Sizing:** AI agent calculates exactly how many units to execute based on real-time market variance to normalize the risk.
3.  **Hard Veto Checks:** Risk agent strictly enforces max leverage, fat-finger traps, and margin availability.
4.  **Execution:** The approved and mathematically sized trade executes on the exchange via Sovereign Local nodes.
5.  **Portfolio Rebalancing:** The portfolio manager agent (`Guardian.ai`) recalibrates the fund's global strategy weights based on the new executing position.
